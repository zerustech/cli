#!/bin/bash

# This file is part of the ZerusTech HTTP Cache Tutorial package.
# 
# (c) Michael Lee <michael.lee@zerustech.com>
#
# For the full copyright and license information, please view the LICENSE file 
# that was distributed with this source code.

base=`cd $(dirname $BASH_SOURCE) && pwd` && source $base/../../lib/php.sh

# This script starts and stops php bulitin servers from command line.
# 
# @author Michael Lee <michael.lee@zerustech.com>

host="0.0.0.0"
port=8000
doc_root=""
pid_file=""
log_file=""
command=""
php_home=""
var=$base/../../var

function usage()
{
    printf "php.service: usage: php.service -b php_home -d doc_root [-h host] [-o port] [-P pid_file] <start|stop> [arguments ...]\n"
    exit 0
}

if [ $# == 0 ]; then
    
    usage

fi

while getopts "b:h:o:d:P:" opt; do

    case $opt in

        b) php_home="$OPTARG";;

        d) doc_root="$OPTARG";;

        h) host="$OPTARG";;

        o) port="$OPTARG";;

        P) pid_file="$OPTARG";;

        *) usage;;

    esac

done

shift $((OPTIND - 1))

if [ "$php_home" == "" ] || [ "$doc_root" == "" ]; then

    usage;

fi

if [ "$pid_file" == "" ]; then

    pid_file="$var/php-$host-$port.pid"

fi

if [ "$log_file" == "" ]; then

    log_file="$var/php-$host-$port.log"

fi

command=$1

shift

case $command in

    start) php_start "$php_home" "$host" "$port" "$doc_root" "$log_file" "$pid_file";;

     stop) php_stop "$pid_file" "$log_file";;

        *) usage;;
esac

printf "\n\n"
